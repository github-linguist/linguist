* File processing with data validation and error handling
FILE TRANS FB(80 0)
  DSN 'FINANCE.TRANS.INPUT'
  DISP SHR

FILE VALID-OUT FB(80 0)
  DSN 'FINANCE.TRANS.VALID'
  DISP(NEW CATLG DELETE)
  SPACE(3 1) CYL
  
FILE ERROR-OUT FB(100 0)
  DSN 'FINANCE.TRANS.ERROR'
  DISP(NEW CATLG DELETE)
  SPACE(2 1) CYL

DEFINE TRANS-ID      1 8 A
DEFINE TRANS-DATE    10 8 N
DEFINE AMOUNT        19 11 N 2 
DEFINE ACCOUNT       31 6 A
DEFINE TRANS-TYPE    38 2 A
DEFINE REFERENCE     41 20 A

DEFINE ERROR-REC     W 100 A
DEFINE ERROR-MSG     W 40 A
DEFINE VALID-COUNT   W 6 N
DEFINE ERROR-COUNT   W 6 N
DEFINE AMOUNT-TOTAL  W 14 N 2

PARM CUTOFF-DATE 8 N

JOB INPUT TRANS

  IF TRANS-ID = SPACES OR TRANS-ID = LOW-VALUE
    ERROR-MSG = 'MISSING TRANSACTION ID'
    GO TO ERROR-PROCESS
  END-IF
  
  IF TRANS-DATE LT CUTOFF-DATE OR TRANS-DATE GT 20250131
    ERROR-MSG = 'INVALID TRANSACTION DATE'
    GO TO ERROR-PROCESS
  END-IF
  
  IF AMOUNT LE 0
    ERROR-MSG = 'AMOUNT MUST BE GREATER THAN ZERO'
    GO TO ERROR-PROCESS
  END-IF
  
  IF TRANS-TYPE NE 'DB' AND TRANS-TYPE NE 'CR' AND TRANS-TYPE NE 'TR'
    ERROR-MSG = 'INVALID TRANSACTION TYPE'
    GO TO ERROR-PROCESS
  END-IF
  
  * Valid record processing
  PUT VALID-OUT FROM TRANS
  VALID-COUNT = VALID-COUNT + 1
  AMOUNT-TOTAL = AMOUNT-TOTAL + AMOUNT
  GO TO NEXT-REC
  
  LABEL ERROR-PROCESS
    ERROR-REC = TRANS + ERROR-MSG
    PUT ERROR-OUT FROM ERROR-REC
    ERROR-COUNT = ERROR-COUNT + 1
  
  LABEL NEXT-REC

END-JOB

DISPLAY 'PROCESSING COMPLETE'
DISPLAY 'VALID RECORDS     :' VALID-COUNT
DISPLAY 'ERROR RECORDS     :' ERROR-COUNT  
DISPLAY 'TOTAL AMOUNT      :' AMOUNT-TOTAL