#!/usr/bin/env ruby

# linguist â€” detect language type for a file, or, given a directory, determine language breakdown
#     usage: linguist <path> [<--breakdown> <--loc>]
#
require 'linguist'
require 'rugged'

path = ARGV[0] || Dir.pwd

# special case if not given a directory but still given the --breakdown option
if path == "--breakdown"
  path = Dir.pwd
  breakdown = true
end
loc = false
if path == "--loc"
  path = Dir.pwd
  loc = true
end

ARGV.shift
breakdown = true if ARGV[0] == "--breakdown"
loc = true if ARGV[0] == "--loc"

if File.directory?(path)
  rugged = Rugged::Repository.new(path)
  repo = Linguist::Repository.new(rugged, rugged.head.target_id)
  if breakdown
    Linguist::Presenters::Breakdown.new(repo).present
  end

  if loc
    Linguist::Presenters::Loc.new(repo).present
  end
elsif File.file?(path)
  Linguist::Presenters::FileBlob.new(path).present
else
  abort "usage: linguist <path> [<--breakdown> <--loc>]"
end
